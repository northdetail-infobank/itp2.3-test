<html>
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>siteA page3</title>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/6.2.0/mocha.min.css"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mocha/6.2.0/mocha.min.js"></script>
    <script src="http://chaijs.com/chai.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="mocha"></div>
    <div id="target">
      <a href="http://3rdpartytestwebkit.org:81/siteB.page2.html">next</a>
    </div>

    <script type="text/javascript">
      function setup() {
        const {expect} = chai

        describe('site-A page-3', function() {

          it('document.cookieから値を取得できる', function() {
            const maxAge = 8 * 24 * 60 * 60; // 8day
            const cookies = Object.fromEntries(document.cookie.split(';').map((v) => v.trim().split('=')))
            expect(cookies.key1).to.equals('value1')
            expect(cookies.key2).to.equals('value2')
            expect(cookies.key3).to.equals('value3')
          })

          it('localStorageから値を取得できる', function() {
            const value1 = localStorage.getItem('key1')
            const value2 = localStorage.getItem('key2')
            const value3 = localStorage.getItem('key3')
            expect(value1).to.equals('value1')
            expect(value2).to.equals('value2')
            expect(value3).to.equals('value3')
          })

          it('document.cookieに値を保存できる', function() {
            const maxAge = 8 * 24 * 60 * 60; // 8day
            document.cookie = `key4=value4; max-age=${maxAge}`;
            const cookies = Object.fromEntries(document.cookie.split(';').map((v) => v.trim().split('=')))
            expect(cookies.key4).to.equals('value4')
          })

          it('localStorageに値を保存できる', function() {
            localStorage.setItem('key4', 'value4')
            const value = localStorage.getItem('key4')
            expect(value).to.equals('value4')
          })

          it('key2のcookieを上書きすると寿命が長くなる', function() {
            const maxAge = 8 * 24 * 60 * 60; // 8day
            document.cookie = `key2=value2; max-age=${maxAge}`;
            const cookies = Object.fromEntries(document.cookie.split(';').map((v) => v.trim().split('=')))
            expect(cookies.key2).to.equals('value2')
          })

        })
      }
    </script>
    <script type="text/javascript">
      mocha.setup("bdd")
      setup();
      mocha.run(failed => {
        if (failed) {
          document.querySelector('#target').innerHtml = "failed"
        }
      })
    </script>
  </body>
</html>